load python3 23-06 for pytorch (with numpy 1.24.3, scikit-learn 1.2.2, torch 1.12.1,  more details: pip list)
Initializing distributed: GLOBAL_RANK: 5, MEMBER: 6/8
Initializing distributed: GLOBAL_RANK: 7, MEMBER: 8/8
Initializing distributed: GLOBAL_RANK: 6, MEMBER: 7/8
Initializing distributed: GLOBAL_RANK: 4, MEMBER: 5/8
Initializing distributed: GLOBAL_RANK: 3, MEMBER: 4/8
Initializing distributed: GLOBAL_RANK: 1, MEMBER: 2/8
Initializing distributed: GLOBAL_RANK: 2, MEMBER: 3/8
wandb: Currently logged in as: aghiles-kebaili. Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in ./wandb/run-20230620_120738-gjvx9ahx
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run Training
wandb: ‚≠êÔ∏è View project at https://wandb.ai/aghiles-kebaili/discrimnative-hvae-for-accurate-tumor-segmentation
wandb: üöÄ View run at https://wandb.ai/aghiles-kebaili/discrimnative-hvae-for-accurate-tumor-segmentation/runs/gjvx9ahx
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/8
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 8 processes
----------------------------------------------------------------------------------------------------

/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/callbacks/model_checkpoint.py:615: UserWarning: Checkpoint directory /gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/checkpoints exists and is not empty.
  rank_zero_warn(f"Checkpoint directory {dirpath} exists and is not empty.")
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2,3]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2,3]
LOCAL_RANK: 2 - CUDA_VISIBLE_DEVICES: [0,1,2,3]
LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2,3]
LOCAL_RANK: 3 - CUDA_VISIBLE_DEVICES: [0,1,2,3]
LOCAL_RANK: 2 - CUDA_VISIBLE_DEVICES: [0,1,2,3]
LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2,3]
LOCAL_RANK: 3 - CUDA_VISIBLE_DEVICES: [0,1,2,3]

  | Name               | Type                    | Params
---------------------------------------------------------------
0 | encoder            | Encoder                 | 35.2 M
1 | decoder            | Decoder                 | 26.9 M
2 | positional_encoder | TimePositionalEmbedding | 0     
3 | class_encoder      | Sequential              | 132 K 
4 | regularization     | LPIPSWithDiscriminator  | 17.5 M
---------------------------------------------------------------
65.0 M    Trainable params
14.7 M    Non-trainable params
79.7 M    Total params
318.705   Total estimated model params size (MB)
SLURM auto-requeueing enabled. Setting signal handlers.
SLURM auto-requeueing enabled. Setting signal handlers.
SLURM auto-requeueing enabled. Setting signal handlers.
SLURM auto-requeueing enabled. Setting signal handlers.
SLURM auto-requeueing enabled. Setting signal handlers.
SLURM auto-requeueing enabled. Setting signal handlers.
SLURM auto-requeueing enabled. Setting signal handlers.
SLURM auto-requeueing enabled. Setting signal handlers.
Traceback (most recent call last):
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/main.py", line 75, in <module>
    trainer.fit(model=model, datamodule=datamodule)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
Traceback (most recent call last):
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/main.py", line 75, in <module>
    trainer.fit(model=model, datamodule=datamodule)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
Traceback (most recent call last):
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/main.py", line 75, in <module>
    trainer.fit(model=model, datamodule=datamodule)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    call._call_and_handle_interrupt(
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    call._call_and_handle_interrupt(
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return function(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    return function(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    return function(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    self._run(model, ckpt_path=ckpt_path)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    self._run(model, ckpt_path=ckpt_path)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    results = self._run_stage()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    results = self._run_stage()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    results = self._run_stage()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    self.fit_loop.run()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.fit_loop.run()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.fit_loop.run()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.advance()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
    self.advance()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
    self.advance()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 133, in run
    self.epoch_loop.run(self._data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 133, in run
    self.epoch_loop.run(self._data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 133, in run
    self.advance(data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 220, in advance
    self.advance(data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 220, in advance
    self.advance(data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 220, in advance
    batch_output = self.manual_optimization.run(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 90, in run
    batch_output = self.manual_optimization.run(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 90, in run
    batch_output = self.manual_optimization.run(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 90, in run
    self.advance(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 109, in advance
    self.advance(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 109, in advance
    self.advance(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 109, in advance
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/ddp.py", line 328, in training_step
    output = fn(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/ddp.py", line 328, in training_step
    output = fn(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/ddp.py", line 328, in training_step
    return self.model(*args, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return self.model(*args, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return self.model(*args, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1008, in forward
    return forward_call(*input, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1008, in forward
    return forward_call(*input, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1008, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 969, in _run_ddp_forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 969, in _run_ddp_forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 969, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return module_to_run(*inputs[0], **kwargs[0])
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return module_to_run(*inputs[0], **kwargs[0])
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
    return forward_call(*input, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/overrides/base.py", line 90, in forward
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/overrides/base.py", line 90, in forward
    return forward_call(*input, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/overrides/base.py", line 90, in forward
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 518, in training_step
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 518, in training_step
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 518, in training_step
    recon_x, z, z0, rho, eps0, gamma, mu, log_var = self.forward(x, pos, cls)
    recon_x, z, z0, rho, eps0, gamma, mu, log_var = self.forward(x, pos, cls)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 394, in forward
    recon_x, z, z0, rho, eps0, gamma, mu, log_var = self.forward(x, pos, cls)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 394, in forward
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 394, in forward
    recon_x = self.decode(z, pemb)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 181, in decode
    recon_x = self.decode(z, pemb)
    recon_x = self.decode(z, pemb)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 181, in decode
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 181, in decode
    x_prob = self.decoder(z, pemb)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    x_prob = self.decoder(z, pemb)
    x_prob = self.decoder(z, pemb)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 117, in forward
    return forward_call(*input, **kwargs)
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 117, in forward
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 117, in forward
    x = self.bottleneck_sa(x)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    x = self.bottleneck_sa(x)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    x = self.bottleneck_sa(x)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/base.py", line 94, in forward
    return forward_call(*input, **kwargs)
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/base.py", line 94, in forward
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/base.py", line 94, in forward
    attention = torch.softmax(torch.matmul(q, k) * self.scale, dim=-1)
RuntimeError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 2; 31.75 GiB total capacity; 30.19 GiB already allocated; 12.00 MiB free; 30.44 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
    attention = torch.softmax(torch.matmul(q, k) * self.scale, dim=-1)
RuntimeError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 3; 31.75 GiB total capacity; 30.19 GiB already allocated; 22.00 MiB free; 30.46 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
    attention = torch.softmax(torch.matmul(q, k) * self.scale, dim=-1)
RuntimeError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 0; 31.75 GiB total capacity; 30.19 GiB already allocated; 36.00 MiB free; 30.44 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
Traceback (most recent call last):
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/main.py", line 75, in <module>
    trainer.fit(model=model, datamodule=datamodule)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return function(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    results = self._run_stage()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    self.fit_loop.run()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.advance()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 133, in run
    self.advance(data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 220, in advance
    batch_output = self.manual_optimization.run(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 90, in run
    self.advance(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 109, in advance
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/ddp.py", line 328, in training_step
    return self.model(*args, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1008, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 969, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/overrides/base.py", line 90, in forward
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 518, in training_step
    recon_x, z, z0, rho, eps0, gamma, mu, log_var = self.forward(x, pos, cls)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 394, in forward
    recon_x = self.decode(z, pemb)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 181, in decode
    x_prob = self.decoder(z, pemb)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 117, in forward
    x = self.bottleneck_sa(x)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/base.py", line 94, in forward
    attention = torch.softmax(torch.matmul(q, k) * self.scale, dim=-1)
RuntimeError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 1; 31.75 GiB total capacity; 30.19 GiB already allocated; 42.00 MiB free; 30.41 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
srun: error: my382: task 5: Exited with exit code 1
srun: Terminating job step 9576061.0
slurmstepd: error: *** STEP 9576061.0 ON my381 CANCELLED AT 2023-06-20T12:09:17 ***
[rank: 1] Received SIGTERM: 15
Bypassing SIGTERM: 15
[rank: 3] Received SIGTERM: 15
Bypassing SIGTERM: 15
[rank: 2] Received SIGTERM: 15
Bypassing SIGTERM: 15
[rank: 0] Received SIGTERM: 15
Bypassing SIGTERM: 15
srun: error: my382: tasks 4,6-7: Exited with exit code 1
Traceback (most recent call last):
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/main.py", line 75, in <module>
    trainer.fit(model=model, datamodule=datamodule)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
Traceback (most recent call last):
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/main.py", line 75, in <module>
    trainer.fit(model=model, datamodule=datamodule)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
Traceback (most recent call last):
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/main.py", line 75, in <module>
    trainer.fit(model=model, datamodule=datamodule)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return function(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    return function(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    return function(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    self._run(model, ckpt_path=ckpt_path)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    self._run(model, ckpt_path=ckpt_path)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    results = self._run_stage()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    results = self._run_stage()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    results = self._run_stage()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    self.fit_loop.run()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.fit_loop.run()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.fit_loop.run()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.advance()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
    self.advance()
    self.advance()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 133, in run
    self.epoch_loop.run(self._data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 133, in run
    self.epoch_loop.run(self._data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 133, in run
    self.advance(data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 220, in advance
    self.advance(data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 220, in advance
    self.advance(data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 220, in advance
    batch_output = self.manual_optimization.run(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 90, in run
    batch_output = self.manual_optimization.run(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 90, in run
    batch_output = self.manual_optimization.run(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 90, in run
    self.advance(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 109, in advance
    self.advance(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 109, in advance
    self.advance(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 109, in advance
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/ddp.py", line 328, in training_step
    output = fn(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/ddp.py", line 328, in training_step
    output = fn(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/ddp.py", line 328, in training_step
    return self.model(*args, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return self.model(*args, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return self.model(*args, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1008, in forward
    return forward_call(*input, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1008, in forward
    return forward_call(*input, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1008, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 969, in _run_ddp_forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 969, in _run_ddp_forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 969, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return module_to_run(*inputs[0], **kwargs[0])
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return module_to_run(*inputs[0], **kwargs[0])
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/overrides/base.py", line 90, in forward
    return forward_call(*input, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/overrides/base.py", line 90, in forward
    return forward_call(*input, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/overrides/base.py", line 90, in forward
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 518, in training_step
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 518, in training_step
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 518, in training_step
    recon_x, z, z0, rho, eps0, gamma, mu, log_var = self.forward(x, pos, cls)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 394, in forward
    recon_x, z, z0, rho, eps0, gamma, mu, log_var = self.forward(x, pos, cls)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 394, in forward
    recon_x, z, z0, rho, eps0, gamma, mu, log_var = self.forward(x, pos, cls)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 394, in forward
    recon_x = self.decode(z, pemb)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 181, in decode
    recon_x = self.decode(z, pemb)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 181, in decode
    recon_x = self.decode(z, pemb)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 181, in decode
    x_prob = self.decoder(z, pemb)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    x_prob = self.decoder(z, pemb)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    x_prob = self.decoder(z, pemb)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 117, in forward
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 117, in forward
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 117, in forward
    x = self.bottleneck_sa(x)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    x = self.bottleneck_sa(x)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    x = self.bottleneck_sa(x)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/base.py", line 94, in forward
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/base.py", line 94, in forward
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/base.py", line 94, in forward
    attention = torch.softmax(torch.matmul(q, k) * self.scale, dim=-1)
    attention = torch.softmax(torch.matmul(q, k) * self.scale, dim=-1)
RuntimeError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 3; 31.75 GiB total capacity; 30.19 GiB already allocated; 32.00 MiB free; 30.45 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
RuntimeError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 1; 31.75 GiB total capacity; 30.19 GiB already allocated; 8.00 MiB free; 30.45 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
    attention = torch.softmax(torch.matmul(q, k) * self.scale, dim=-1)
RuntimeError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 2; 31.75 GiB total capacity; 30.19 GiB already allocated; 8.00 MiB free; 30.45 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
Traceback (most recent call last):
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/main.py", line 75, in <module>
    trainer.fit(model=model, datamodule=datamodule)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return function(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    results = self._run_stage()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    self.fit_loop.run()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.advance()
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 133, in run
    self.advance(data_fetcher)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 220, in advance
    batch_output = self.manual_optimization.run(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 90, in run
    self.advance(kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/manual.py", line 109, in advance
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/strategies/ddp.py", line 328, in training_step
    return self.model(*args, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1008, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 969, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/2021012/sruan01/riles/env/lib/python3.10/site-packages/pytorch_lightning/overrides/base.py", line 90, in forward
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 518, in training_step
    recon_x, z, z0, rho, eps0, gamma, mu, log_var = self.forward(x, pos, cls)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 394, in forward
    recon_x = self.decode(z, pemb)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 181, in decode
    x_prob = self.decoder(z, pemb)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/autoencoders.py", line 117, in forward
    x = self.bottleneck_sa(x)
  File "/soft/Python3-DL/conda_envs/torch112/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/gpfs1/home/2021012/sruan01/riles/discriminative-hvae-for-accurate-tumor-segmentation/modules/base.py", line 94, in forward
    attention = torch.softmax(torch.matmul(q, k) * self.scale, dim=-1)
RuntimeError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 0; 31.75 GiB total capacity; 30.19 GiB already allocated; 32.00 MiB free; 30.45 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
wandb: Waiting for W&B process to finish... (failed 1). Press Control-C to abort syncing.
srun: error: my381: tasks 1-3: Exited with exit code 1
wandb: üöÄ View run Training at: https://wandb.ai/aghiles-kebaili/discrimnative-hvae-for-accurate-tumor-segmentation/runs/gjvx9ahx
wandb: Synced 6 W&B file(s), 0 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20230620_120738-gjvx9ahx/logs
srun: error: my381: task 0: Exited with exit code 1
